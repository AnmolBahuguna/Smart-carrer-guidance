{% extends "base.html" %}

{% block title %}Career Quiz - SmartCareer{% endblock %}

{% block content %}
<section class="py-12 min-h-screen relative overflow-hidden">
    <!-- Animated Background Elements -->
    <div class="particles">
        <div class="particle" style="left: 5%; animation-delay: 0s;"></div>
        <div class="particle" style="left: 15%; animation-delay: 3s;"></div>
        <div class="particle" style="left: 25%; animation-delay: 6s;"></div>
        <div class="particle" style="left: 35%; animation-delay: 9s;"></div>
        <div class="particle" style="left: 45%; animation-delay: 12s;"></div>
        <div class="particle" style="left: 55%; animation-delay: 15s;"></div>
        <div class="particle" style="left: 65%; animation-delay: 18s;"></div>
        <div class="particle" style="left: 75%; animation-delay: 21s;"></div>
        <div class="particle" style="left: 85%; animation-delay: 24s;"></div>
        <div class="particle" style="left: 95%; animation-delay: 27s;"></div>
    </div>
    
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <!-- Header -->
        <div class="text-center mb-8" data-aos="fade-up">
            <div class="inline-block bg-gradient-to-r from-indigo-600 to-purple-600 p-6 rounded-3xl mb-4 shadow-2xl floating pulse-glow">
                <i class="fas fa-clipboard-list text-4xl text-white"></i>
            </div>
            <h1 class="text-5xl font-bold mb-4 gradient-text text-3d">Career Assessment Quiz</h1>
            <p class="text-gray-600 text-lg neon-text">Answer these questions to discover your ideal career path</p>
        </div>
        
        <!-- Progress Bar -->
        <div class="mb-8">
            <div class="flex justify-between mb-3">
                <span class="text-sm font-bold text-gray-700 flex items-center gap-2">
                    <i class="fas fa-chart-line text-indigo-600"></i>
                    Progress
                </span>
                <span class="text-sm font-bold text-gray-700">
                    <span id="current-question" class="text-indigo-600">1</span> / <span id="total-questions">10</span>
                </span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 shadow-inner">
                <div id="progress-bar" class="bg-gradient-to-r from-indigo-600 to-purple-600 h-4 rounded-full transition-all duration-500 shadow-lg" style="width: 10%"></div>
            </div>
        </div>
        
        <!-- Quiz Container -->
        <div id="quiz-container" class="card-3d glass p-8" data-aos="fade-up">
            <!-- Questions will be loaded here -->
        </div>
        
        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-8">
            <button id="prev-btn" class="btn-3d bg-gradient-to-r from-gray-500 to-gray-600 text-white px-8 py-4 rounded-2xl hover:from-gray-600 hover:to-gray-700 transition transform hover:scale-105 hidden">
                <i class="fas fa-arrow-left mr-2"></i>
                <span class="font-bold">Previous</span>
            </button>
            <button id="next-btn" class="btn-3d bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-2xl hover:from-indigo-700 hover:to-purple-700 transition transform hover:scale-105 ml-auto">
                <span class="font-bold">Next</span>
                <i class="fas fa-arrow-right ml-2"></i>
            </button>
            <button id="submit-btn" class="btn-3d bg-gradient-to-r from-green-600 to-emerald-600 text-white px-8 py-4 rounded-2xl hover:from-green-700 hover:to-emerald-700 transition transform hover:scale-105 ml-auto hidden">
                <i class="fas fa-check mr-2"></i>
                <span class="font-bold">Submit Quiz</span>
            </button>
        </div>
    </div>
</section>

<!-- Loading Modal -->
<div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 text-center">
        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600 mx-auto mb-4"></div>
        <p class="text-xl font-semibold">Analyzing your responses...</p>
        <p class="text-gray-600 mt-2">Finding the perfect career match for you!</p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    const quizQuestions = [
        {
            id: 1,
            question: "If you could spend a Saturday solving any type of problem, what would it be?",
            type: "interests",
            options: [
                { value: "technology", label: "Debugging a complex software issue or building an app" },
                { value: "creative", label: "Designing a visual campaign or writing compelling content" },
                { value: "business", label: "Creating a business plan or optimizing a workflow" },
                { value: "analytics", label: "Finding patterns in data or solving a mathematical puzzle" }
            ]
        },
        {
            id: 2,
            question: "When learning something new, what approach works best for you?",
            type: "skills",
            options: [
                { value: "programming", label: "Hands-on coding and immediate experimentation" },
                { value: "design", label: "Visual learning through sketches and prototypes" },
                { value: "writing", label: "Reading, discussing, and explaining concepts to others" },
                { value: "mathematics", label: "Understanding the underlying theory and formulas" }
            ]
        },
        {
            id: 3,
            question: "What type of project would make you feel most accomplished?",
            type: "personality",
            options: [
                { value: "remote", label: "A solo project you can complete from anywhere" },
                { value: "office", label: "A team project with clear roles and daily collaboration" },
                { value: "hybrid", label: "A flexible project mixing independent work and team meetings" },
                { value: "dynamic", label: "A fast-paced project with changing requirements and deadlines" }
            ]
        },
        {
            id: 4,
            question: "In a group setting, what role do you naturally take?",
            type: "personality",
            options: [
                { value: "team", label: "The collaborative contributor who builds consensus" },
                { value: "independent", label: "The specialist who focuses on my specific tasks" },
                { value: "leader", label: "The coordinator who organizes and motivates others" },
                { value: "collaborative", label: "The connector who links different team members' ideas" }
            ]
        },
        {
            id: 5,
            question: "What would make you jump out of bed excited for work?",
            type: "interests",
            options: [
                { value: "innovation", label: "Building something that's never existed before" },
                { value: "stability", label: "Knowing exactly what to expect and mastering your role" },
                { value: "growth", label: "Learning new skills and advancing to higher positions" },
                { value: "impact", label: "Seeing your work directly improve someone's life" }
            ]
        },
        {
            id: 6,
            question: "Which real-world problem fascinates you most?",
            type: "skills",
            options: [
                { value: "mathematics", label: "Optimizing supply chains or financial systems" },
                { value: "arts", label: "Improving communication through better design and storytelling" },
                { value: "social", label: "Addressing inequality or educational access" },
                { value: "technology", label: "Creating sustainable tech solutions for global challenges" }
            ]
        },
        {
            id: 7,
            question: "How do you feel about deadlines and pressure?",
            type: "personality",
            options: [
                { value: "flexible", label: "I work best with flexible deadlines and creative freedom" },
                { value: "structured", label: "I thrive with clear deadlines and predictable schedules" },
                { value: "intense", label: "I perform best under pressure with tight deadlines" },
                { value: "balanced", label: "I prefer steady progress with moderate, realistic deadlines" }
            ]
        },
        {
            id: 8,
            question: "When faced with a complex challenge, what's your first instinct?",
            type: "skills",
            options: [
                { value: "problemsolving", label: "Break it down into logical, step-by-step components" },
                { value: "creative", label: "Brainstorm multiple unconventional approaches" },
                { value: "research", label: "Research how others have solved similar problems" },
                { value: "collaboration", label: "Gather different perspectives from a diverse group" }
            ]
        },
        {
            id: 9,
            question: "If you had unlimited resources, what would you create?",
            type: "interests",
            options: [
                { value: "technology", label: "A revolutionary tech company or software platform" },
                { value: "creative", label: "A media company producing films, music, or art" },
                { value: "business", label: "A sustainable business that transforms an industry" },
                { value: "healthcare", label: "A research facility solving major health challenges" }
            ]
        },
        {
            id: 10,
            question: "What legacy do you want to leave through your work?",
            type: "personality",
            options: [
                { value: "practical", label: "Useful tools and solutions that people rely on daily" },
                { value: "theoretical", label: "New knowledge and understanding that advances your field" },
                { value: "visual", label: "Beautiful creations that inspire and move people" },
                { value: "experimental", label: "Breakthrough innovations that change how we live" }
            ]
        }
    ];
    
    let currentQuestion = 0;
    let answers = {
        interests: [],
        skills: [],
        personality: ''
    };
    
    function loadQuestion(index) {
        const question = quizQuestions[index];
        const container = document.getElementById('quiz-container');
        
        let optionsHTML = '';
        question.options.forEach((option, i) => {
            optionsHTML += `
                <div class="option-card border-2 border-gray-200 rounded-lg p-4 mb-3 cursor-pointer hover:border-indigo-600 hover:bg-indigo-50 transition" data-value="${option.value}">
                    <div class="flex items-center">
                        <div class="w-6 h-6 rounded-full border-2 border-gray-300 mr-3 flex items-center justify-center">
                            <div class="w-3 h-3 rounded-full bg-indigo-600 hidden option-selected"></div>
                        </div>
                        <span class="text-gray-700 font-medium">${option.label}</span>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = `
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-2 text-gray-800">Question ${index + 1}</h2>
                <p class="text-lg text-gray-600">${question.question}</p>
            </div>
            <div id="options-container">
                ${optionsHTML}
            </div>
        `;
        
        // Add click listeners to options
        document.querySelectorAll('.option-card').forEach(card => {
            card.addEventListener('click', function() {
                // Remove previous selection
                document.querySelectorAll('.option-card').forEach(c => {
                    c.classList.remove('border-indigo-600', 'bg-indigo-50');
                    c.querySelector('.option-selected').classList.add('hidden');
                });
                
                // Add new selection
                this.classList.add('border-indigo-600', 'bg-indigo-50');
                this.querySelector('.option-selected').classList.remove('hidden');
                
                // Store answer
                const type = question.type;
                const value = this.dataset.value;
                
                if (type === 'interests' || type === 'skills') {
                    if (!answers[type].includes(value)) {
                        answers[type].push(value);
                    }
                } else {
                    answers[type] = value;
                }
            });
        });
        
        // Update progress
        updateProgress();
        updateButtons();
    }
    
    function updateProgress() {
        const progress = ((currentQuestion + 1) / quizQuestions.length) * 100;
        document.getElementById('progress-bar').style.width = progress + '%';
        document.getElementById('current-question').textContent = currentQuestion + 1;
        document.getElementById('total-questions').textContent = quizQuestions.length;
    }
    
    function updateButtons() {
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        
        // Show/hide previous button
        if (currentQuestion > 0) {
            prevBtn.classList.remove('hidden');
        } else {
            prevBtn.classList.add('hidden');
        }
        
        // Show/hide next and submit buttons
        if (currentQuestion === quizQuestions.length - 1) {
            nextBtn.classList.add('hidden');
            submitBtn.classList.remove('hidden');
        } else {
            nextBtn.classList.remove('hidden');
            submitBtn.classList.add('hidden');
        }
    }
    
    async function submitQuiz() {
        // Show loading modal
        document.getElementById('loading-modal').classList.remove('hidden');
        document.getElementById('loading-modal').classList.add('flex');
        
        try {
            const response = await fetch('/submit_quiz', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ answers: answers })
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Redirect to results page
                setTimeout(() => {
                    window.location.href = '/results';
                }, 1500);
            } else {
                alert('Error: ' + data.error);
                document.getElementById('loading-modal').classList.add('hidden');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
            document.getElementById('loading-modal').classList.add('hidden');
        }
    }
    
    // Event listeners
    document.getElementById('next-btn').addEventListener('click', function() {
        if (currentQuestion < quizQuestions.length - 1) {
            currentQuestion++;
            loadQuestion(currentQuestion);
        }
    });
    
    document.getElementById('prev-btn').addEventListener('click', function() {
        if (currentQuestion > 0) {
            currentQuestion--;
            loadQuestion(currentQuestion);
        }
    });
    
    document.getElementById('submit-btn').addEventListener('click', submitQuiz);
    
    // Load first question
    loadQuestion(0);
</script>
{% endblock %}
