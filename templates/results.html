{% extends "base.html" %}

{% block title %}Quiz Results - SmartCareer{% endblock %}

{% block content %}
<section class="py-12 bg-gray-50 min-h-screen">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Success Header -->
        <div class="text-center mb-12" data-aos="fade-up">
            <div class="inline-block bg-green-100 text-green-600 p-4 rounded-full mb-4">
                <i class="fas fa-check-circle text-5xl"></i>
            </div>
            <h1 class="text-4xl font-bold mb-4 gradient-text">Your Career Recommendations</h1>
            <p class="text-gray-600 text-lg">Based on your quiz responses, here are your top career matches!</p>
        </div>
        
        {% if recommendations %}
        <!-- Top Recommendations -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            {% for rec in recommendations %}
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover {% if loop.index == 1 %}border-4 border-indigo-600{% endif %}" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 }}">
                {% if loop.index == 1 %}
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-sm font-bold px-3 py-1 rounded-full inline-block mb-4">
                    <i class="fas fa-crown mr-1"></i>Best Match
                </div>
                {% endif %}
                
                <div class="text-center mb-4">
                    <div class="w-16 h-16 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-3">
                        <span class="text-3xl font-bold text-white">#{{ rec.rank }}</span>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">{{ rec.career }}</h2>
                </div>
                
                <!-- Compatibility Score -->
                <div class="mb-4">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Match Score</span>
                        <span class="text-sm font-bold text-indigo-600">{{ rec.score }}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 h-3 rounded-full transition-all duration-1000 progress-bar-fill" data-width="{{ rec.score }}"></div>
                    </div>
                </div>
                
                <!-- Description -->
                <p class="text-gray-600 text-sm mb-4">{{ rec.description }}</p>
                
                <!-- Salary Range -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">
                            <i class="fas fa-dollar-sign text-green-600 mr-1"></i>Avg. Salary
                        </span>
                        <span class="text-sm font-bold text-green-700">{{ rec.avg_salary }}</span>
                    </div>
                </div>
                
                <!-- Skills Needed -->
                <div class="mb-4">
                    <h4 class="text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-tools mr-1"></i>Key Skills
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        {% for skill in rec.skills_needed %}
                        <span class="bg-indigo-100 text-indigo-700 text-xs px-3 py-1 rounded-full">{{ skill }}</span>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Action Button -->
                <a href="/roadmap/{{ rec.career }}" class="block w-full bg-indigo-600 text-white text-center py-3 rounded-lg hover:bg-indigo-700 transition font-semibold mt-4">
                    <i class="fas fa-route mr-2"></i>View Roadmap
                </a>
            </div>
            {% endfor %}
        </div>
        
        <!-- Detailed Comparison Chart -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-8" data-aos="fade-up">
            <h3 class="text-2xl font-bold mb-6 text-center">Career Match Comparison</h3>
            <canvas id="comparisonChart" height="80"></canvas>
        </div>
        
        <!-- Next Steps -->
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl shadow-lg p-8 text-white" data-aos="fade-up">
            <h3 class="text-2xl font-bold mb-6 text-center">What's Next?</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="bg-white bg-opacity-20 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-route text-3xl"></i>
                    </div>
                    <h4 class="font-bold mb-2">Explore Roadmap</h4>
                    <p class="text-sm text-gray-100">Get a detailed learning path for your top career choice</p>
                </div>
                <div class="text-center">
                    <div class="bg-white bg-opacity-20 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-robot text-3xl"></i>
                    </div>
                    <h4 class="font-bold mb-2">Chat with AI Mentor</h4>
                    <p class="text-sm text-gray-100">Ask questions about your recommended careers</p>
                </div>
                <div class="text-center">
                    <div class="bg-white bg-opacity-20 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-file-alt text-3xl"></i>
                    </div>
                    <h4 class="font-bold mb-2">Build Resume</h4>
                    <p class="text-sm text-gray-100">Create a professional resume for your career path</p>
                </div>
            </div>
            
            <div class="flex justify-center gap-4 mt-8">
                <a href="/chatbot" class="bg-white text-indigo-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
                    <i class="fas fa-robot mr-2"></i>Chat Now
                </a>
                <a href="/dashboard" class="bg-transparent border-2 border-white text-white px-6 py-3 rounded-lg font-semibold hover:bg-white hover:text-indigo-600 transition">
                    <i class="fas fa-dashboard mr-2"></i>Go to Dashboard
                </a>
            </div>
        </div>
        
        {% else %}
        <div class="text-center py-12">
            <i class="fas fa-exclamation-circle text-6xl text-yellow-500 mb-4"></i>
            <h2 class="text-2xl font-bold mb-4">No Results Found</h2>
            <p class="text-gray-600 mb-6">Please take the quiz first to see your career recommendations.</p>
            <a href="/quiz" class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition inline-block">
                <i class="fas fa-clipboard-list mr-2"></i>Take Quiz
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block extra_js %}
{% if recommendations %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
<script>
(function() {
    'use strict';
    
    document.addEventListener('DOMContentLoaded', function() {
        try {
            // Animate progress bars
            var progressBars = document.querySelectorAll('.progress-bar-fill');
            progressBars.forEach(function(bar) {
                var width = bar.getAttribute('data-width');
                setTimeout(function() {
                    bar.style.width = width + '%';
                }, 100);
            });
        } catch (e) {
            console.error('Progress bar animation error:', e);
        }
        
        // Chart data from server
        var chartData = {
            careers: {{ recommendations|map(attribute='career')|list|tojson|safe }},
            scores: {{ recommendations|map(attribute='score')|list|tojson|safe }}
        };
        
        // Initialize chart
        function initChart() {
            try {
                if (typeof Chart === 'undefined') {
                    setTimeout(initChart, 100);
                    return;
                }
                
                var ctx = document.getElementById('comparisonChart');
                if (!ctx) return;
                
                new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: chartData.careers,
                        datasets: [{
                            label: 'Match Score (%)',
                            data: chartData.scores,
                            backgroundColor: [
                                'rgba(99, 102, 241, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(168, 85, 247, 0.8)'
                            ],
                            borderColor: [
                                'rgb(99, 102, 241)',
                                'rgb(139, 92, 246)',
                                'rgb(168, 85, 247)'
                            ],
                            borderWidth: 2,
                            borderRadius: 8,
                            barThickness: 60
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        animation: {
                            duration: 1500,
                            easing: 'easeOutQuart'
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) { return value + '%'; },
                                    font: { size: 12 }
                                },
                                grid: { color: 'rgba(0, 0, 0, 0.05)' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { font: { size: 12, weight: 'bold' } }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 13 },
                                callbacks: {
                                    label: function(context) {
                                        return 'Match Score: ' + context.parsed.y + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.error('Chart initialization error:', e);
            }
        }
        
        initChart();
    });
})();
</script>
{% endif %}
{% endblock %}
